<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\Techo.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Techo.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/55</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/24</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/13</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/57</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">//SPDX-License-Identifier: Unlicense
pragma solidity ^0.8.0;
&nbsp;
import "hardhat/console.sol";
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/utils/Strings.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "./Enums.sol";
&nbsp;
struct Cycle {
    uint8 index;
    uint256 start;
    uint256 finish;
    bool paid;
}
&nbsp;
contract Techo is Ownable {
    using Strings for uint256;
&nbsp;
    IERC20 erc20;
    ContractStatus public contractStatus;
    address public landlord;
    address public tenant;
    uint256 mockTime = 0;
&nbsp;
    string activationFailed = "contract activation failed";
    string alreadyActive = "contract is already active";
    string minContractDuration = "Required minimum contract duration is 1 week";
    string contractDurationLargerThanFrequency =
        "Payment frequency should be less than the contract duration";
    string collectedRent = "you have already collected rent this current cycle";
    string contractNotActive = "contract is not active";
    string onlyTenant = "only tenant can call this function";
    string onlyLandlord = "only landlord can call this function";
    string notCurrentCycle =
        "Cannot collect from a cycle which is not the current one";
&nbsp;
    uint256 public contractAmount;
    uint256 public activationTime;
    uint256 public finalizationTime;
    uint256 public contractDuration;
    uint256 public ownerFee;
    uint256 public frequency;
    uint256 public amountToPayByFrequency;
    mapping(uint8 =&gt; Cycle) public cycleMapping;
    Cycle[] cycleArray;
&nbsp;
    event Activated(
        address indexed _tenant,
        address indexed _landlord,
        uint256 _amount
    );
&nbsp;
    event RentCollected(uint256 amount);
    event Cancelled();
&nbsp;
<span class="fstat-no" title="function not covered" >    constructor(</span>
        address _erc20address,
        address _tenant,
        address _landlord,
        uint256 _contractDuration,
        uint256 _contractAmount,
        uint256 _frequency,
        uint8 _ownerFee
    ) {
<span class="cstat-no" title="statement not covered" >        require(_contractDuration &gt;= 604800, minContractDuration)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        require(</span>
            _contractDuration &gt; _frequency,
            contractDurationLargerThanFrequency
        );
&nbsp;
<span class="cstat-no" title="statement not covered" >        erc20 = IERC20(_erc20address)</span>;
<span class="cstat-no" title="statement not covered" >        tenant = _tenant</span>;
<span class="cstat-no" title="statement not covered" >        landlord = _landlord</span>;
<span class="cstat-no" title="statement not covered" >        contractStatus = ContractStatus.NOTACTIVE</span>;
<span class="cstat-no" title="statement not covered" >        contractAmount = _contractAmount</span>;
<span class="cstat-no" title="statement not covered" >        contractDuration = _contractDuration</span>;
<span class="cstat-no" title="statement not covered" >        ownerFee = _ownerFee</span>;
<span class="cstat-no" title="statement not covered" >        frequency = _frequency</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        amountToPayByFrequency =</span>
            (contractAmount) /
            (contractDuration / frequency);
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 cycleCount = contractDuration / frequency;</span>
<span class="cstat-no" title="statement not covered" >        uint256 prevStart = getCurrentTime();</span>
<span class="cstat-no" title="statement not covered" >        uint256 prevFinish = getCurrentTime() + frequency;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        cycleArray.push(Cycle(0, prevStart, prevFinish, false))</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        for (uint8 i = 1; cycleCount &gt; i; i++) {</span>
<span class="cstat-no" title="statement not covered" >            uint256 start = prevFinish;</span>
<span class="cstat-no" title="statement not covered" >            uint256 finish = start + frequency;</span>
<span class="cstat-no" title="statement not covered" >            cycleArray.push(Cycle(i, start, finish, false))</span>;
<span class="cstat-no" title="statement not covered" >            cycleMapping[i] = Cycle(i, start, finish, false)</span>;
<span class="cstat-no" title="statement not covered" >            prevStart = start</span>;
<span class="cstat-no" title="statement not covered" >            prevFinish = finish</span>;
        }
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getCurrentTime() public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        if (mockTime == 0) {</span>
<span class="cstat-no" title="statement not covered" >            return block.timestamp;</span>
        } else {
<span class="cstat-no" title="statement not covered" >            return mockTime;</span>
        }
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getOwnerFeeAmount() public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return (contractAmount / 100) * ownerFee;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function approve(uint256 amount) public returns (bool) {</span>
<span class="cstat-no" title="statement not covered" >        return erc20.approve(address(this), amount);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function allowance() public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return erc20.allowance(tenant, address(this));</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function activate(uint256 amount) external payable _tenantOnly {</span>
<span class="cstat-no" title="statement not covered" >        uint256 fee = getOwnerFeeAmount();</span>
<span class="cstat-no" title="statement not covered" >        require(amount == (contractAmount + fee), activationFailed)</span>;
<span class="cstat-no" title="statement not covered" >        require(contractStatus == ContractStatus.NOTACTIVE, alreadyActive)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        bool success = erc20.transferFrom(msg.sender, address(this), amount);</span>
<span class="cstat-no" title="statement not covered" >        require(success, activationFailed)</span>;
<span class="cstat-no" title="statement not covered" >        contractStatus = ContractStatus.ACTIVE</span>;
<span class="cstat-no" title="statement not covered" >        activationTime = getCurrentTime()</span>;
<span class="cstat-no" title="statement not covered" >        finalizationTime = getCurrentTime() + contractDuration</span>;
<span class="cstat-no" title="statement not covered" >        erc20.transfer(owner(), fee)</span>;
<span class="cstat-no" title="statement not covered" >        emit Activated(tenant, landlord, amount);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function checkerc20Balance() public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return erc20.balanceOf(address(this));</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function checkRemainingDuration() public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return finalizationTime - (activationTime + getCurrentTime());</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function collectRent(uint8 cycleIndex) public _landlordOnly {</span>
<span class="cstat-no" title="statement not covered" >        require(contractStatus == ContractStatus.ACTIVE, contractNotActive)</span>;
<span class="cstat-no" title="statement not covered" >        require(cycleMapping[cycleIndex].paid == false, collectedRent)</span>;
<span class="cstat-no" title="statement not covered" >        require(</span>
            cycleMapping[cycleIndex].start &lt; getCurrentTime() &amp;&amp;
                cycleMapping[cycleIndex].finish &lt; getCurrentTime(),
            notCurrentCycle
        );
&nbsp;
<span class="cstat-no" title="statement not covered" >        cycleMapping[cycleIndex].paid = true</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        erc20.transfer(landlord, amountToPayByFrequency)</span>;
<span class="cstat-no" title="statement not covered" >        emit RentCollected(amountToPayByFrequency);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function cancelContract() public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(contractStatus == ContractStatus.ACTIVE, contractNotActive)</span>;
<span class="cstat-no" title="statement not covered" >        contractStatus = ContractStatus.CANCELLED</span>;
<span class="cstat-no" title="statement not covered" >        uint256 balance = checkerc20Balance();</span>
<span class="cstat-no" title="statement not covered" >        erc20.transfer(tenant, balance)</span>;
<span class="cstat-no" title="statement not covered" >        emit Cancelled();</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function extract() public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        uint256 balance = checkerc20Balance();</span>
<span class="cstat-no" title="statement not covered" >        erc20.transferFrom(address(this), owner(), balance)</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier _tenantOnly() {</span>
<span class="cstat-no" title="statement not covered" >        require(msg.sender == tenant, onlyTenant)</span>;
        _;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier _landlordOnly() {</span>
<span class="cstat-no" title="statement not covered" >        require(msg.sender == landlord, onlyLandlord)</span>;
        _;
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Aug 13 2021 13:23:51 GMT-0300 (Argentina Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
